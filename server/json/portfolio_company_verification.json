{
  "workflow": {
    "name": "Portfolio Company Verification and Form 5500 Matching",
    "description": "Multi-step verification of portfolio companies with Form 5500 matching",
    "tasks": [
      {
        "id": 1,
        "name": "ResearchCompanyLocations",
        "outputKey": "companies_with_locations",
        "inputKeys": ["input"],
        "allowed_tools": ["search_web"],
        "instructions": "Find headquarters location for the portfolio company. Use perplexity_search to find the city and state. Full address is NOT needed. Start by performing this EXACT search with the perplexity web search tool: 'In what city and state is the headquarters for the legal entity DBA <company name>, a portfolio company of <firm name>?' Replace the variables in brackets with the firm name and company name with which you were supplied. This query is necessarry to prevent you accidentally finding the headquarters of the wrong company. Return JSON: {company_name, firm_name, headquarters_location: {city, state, research_confidence}}. If there are two possibilities and it's unclear which is true, INCLUDE BOTH. Include no comments in your response."
      },
      {
        "id": 2,
        "name": "FindAnnualRevenue",
        "outputKey": "revenue_research",
        "inputKeys": ["companies_with_locations"],
        "allowed_tools": ["search_web"],
        "instructions": "Find the annual revenue for the company using perplexity_search. Search for: 'What is the annual revenue of [legal_entity_name/company_name]?' Return JSON: {company_name, firm_name, headquarters_location, revenue_research: {annual_revenue_usd, revenue_year, research_confidence, source_info}}. Include no comments in your response."
      },
      {
        "id": 3,
        "name": "VerifyPortfolioStatus", 
        "outputKey": "verified_portfolio_companies",
        "inputKeys": ["revenue_research"],
        "allowed_tools": ["search_web"],
        "instructions": "Your task is to check if there is conclusive proof that the company was sold/exited by the firm. Start with the assumption that it was not. Perform a single web search. If you find conclusive evidence that it was sold/exited by the firm, indicate as such. Return JSON: {company_name, firm_name, headquarters_location, revenue_research, portfolio_verification: {exited: bool, verification_confidence, investment_details, status_notes}}. Include no comments in your response."
      },
      {
        "id": 4,
        "name": "FindLegalEntityName",
        "outputKey": "legal_entity_research",
        "inputKeys": ["verified_portfolio_companies"],
        "allowed_tools": ["search_web"],
        "instructions": "Find legal entity name using perplexity_search query: 'What legal entity is DBA [company name], a portfolio company of [pe firm name]?' Return JSON: {company_name, firm_name, headquarters_location, revenue_research, portfolio_verification, legal_entity_research: {legal_entity_name, research_confidence, source_info}}. Include no comments in your response."
      },
      {
        "id": 5,
        "name": "TestForm5500Matches",
        "outputKey": "form5500_test_results", 
        "inputKeys": ["legal_entity_research"],
        "instructions": "Test Form 5500 matches using form5500_name_test. Search order: 1) Legal entity name from previous task 2) Original company name 3) Shortened versions (remove suffixes) 4) Common variations. Inclusive search returns broader results, so start broad. Return JSON: {company_name, firm_name, headquarters_location, revenue_research, portfolio_verification, legal_entity_research, form5500_match: {legal_name, ein, location, match_type, record_count, variation_used}}. Include only the JSON. Include no comments in your response under any conditions."
      }
    ]
  }
}