{
  "workflow": {
    "name": "Portfolio Company Verification and Form 5500 Matching",
    "description": "Multi-step verification of portfolio companies with Form 5500 matching",
    "tasks": [
      {
        "id": 1,
        "name": "ResearchCompanyLocations",
        "outputKey": "companies_with_locations",
        "inputKeys": ["input"],
        "instructions": "For the given portfolio company, find its headquarters location. Use the PE firm name as context to help identify the correct company. Use perplexity_search or research_legal_entity to find city and state of headquarters, complete address if possible, and verify this is the main operational headquarters. Include the PE firm context in your searches to ensure accuracy. Return results as JSON: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {\"city\": \"City Name\", \"state\": \"State\", \"full_address\": \"Complete address if found\", \"research_confidence\": \"high/medium/low\"}}. Include only the formatted JSON in your response, exclude any other text or comments."
      },
      {
        "id": 2,
        "name": "VerifyPortfolioStatus", 
        "outputKey": "verified_portfolio_companies",
        "inputKeys": ["companies_with_locations"],
        "instructions": "For the company from the previous task, verify if it is currently an active portfolio company of the given PE firm. Use perplexity_search to research the company and verify: Is it currently an active portfolio company of the firm? When was the investment made? Has the company been exited/sold? Any recent news about the investment status? If the company is an active portfolio investment, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {\"is_active_portfolio\": true, \"verification_confidence\": \"high/medium/low\", \"investment_details\": \"Brief description\", \"investment_date\": \"Year if found\", \"status_notes\": \"Relevant notes\"}}. If the company is NOT an active portfolio investment, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"reason\": \"Company was exited in 2022\", \"headquarters_location\": {...}, \"is_active_portfolio\": false}. Be conservative - if uncertain, mark verification_confidence as low. Include only the formatted JSON in your response, exclude any other text or comments."
      },
      {
        "id": 3,
        "name": "CheckEmployeeCount",
        "outputKey": "employee_count_check",
        "inputKeys": ["verified_portfolio_companies"],
        "instructions": "For the verified active portfolio company from the previous task, determine if it had fewer than 100 employees in 2024. Only proceed if the previous task confirmed the company is an active portfolio investment (is_active_portfolio: true). Use perplexity_search to research the company's employee count in 2024. Search for information about company size, headcount, workforce, number of employees, or similar indicators. The criterion is whether it is more likely than not that the company had fewer than 100 employees in 2024. Companies with fewer than 100 employees typically do not file Form 5500 reports. If the company likely had fewer than 100 employees in 2024, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {\"likely_under_100_employees\": true, \"confidence\": \"high/medium/low\", \"evidence\": \"Brief description of evidence found\", \"year\": \"2024\"}, \"status\": \"LIKELY_NO_FORM_5500\"}. If the company likely had 100 or more employees in 2024, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {\"likely_under_100_employees\": false, \"confidence\": \"high/medium/low\", \"evidence\": \"Brief description of evidence found\", \"year\": \"2024\"}, \"status\": \"PROCEED_TO_FORM_5500\"}. If the previous task showed the company is not an active portfolio investment, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"reason\": \"Not an active portfolio company\", \"status\": \"SKIPPED\"}. Be realistic about confidence levels - exact employee counts are often not publicly available. Include only the formatted JSON in your response, exclude any other text or comments."
      },
      {
        "id": 4,
        "name": "FindLegalEntityName",
        "outputKey": "legal_entity_research",
        "inputKeys": ["employee_count_check"],
        "instructions": "For the company from the previous task, find the legal entity name most likely used in Form 5500 filings. Only proceed if the previous task indicated the company likely has 100+ employees (status: \"PROCEED_TO_FORM_5500\"). If the previous task indicated the company likely has fewer than 100 employees (status: \"LIKELY_NO_FORM_5500\"), return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"reason\": \"Company likely has fewer than 100 employees\", \"status\": \"SKIPPED_SMALL_COMPANY\"}. Use perplexity_search with this exact query: \"What legal entity is DBA <company name>, a portfolio company of <pe firm name>?\" Replace <company name> with the actual company name and <pe firm name> with the actual PE firm name. The goal is to find the official legal entity name that would appear in Department of Labor Form 5500 filings, which may be different from the company's common business name. If a legal entity name is found, return: {\"company_name\": \"Original Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {...}, \"legal_entity_research\": {\"legal_entity_name\": \"Found Legal Entity Name\", \"research_confidence\": \"high/medium/low\", \"source_info\": \"Brief description of source or context found\"}, \"status\": \"LEGAL_ENTITY_FOUND\"}. If no clear legal entity name is found or the research is inconclusive, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {...}, \"legal_entity_research\": {\"legal_entity_name\": \"\", \"research_confidence\": \"low\", \"source_info\": \"No clear legal entity name found\"}, \"status\": \"LEGAL_ENTITY_UNCLEAR\"}. Include only the formatted JSON in your response, exclude any other text or comments."
      },
      {
        "id": 5,
        "name": "TestForm5500Matches",
        "outputKey": "form5500_test_results", 
        "inputKeys": ["legal_entity_research"],
        "instructions": "For the company from the previous task, test for matches in the Form 5500 database. Only proceed if the previous task indicated the company likely has 100+ employees and legal entity research was conducted (status: \"LEGAL_ENTITY_FOUND\" or \"LEGAL_ENTITY_UNCLEAR\"). If the previous task indicated the company was skipped due to small size, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"reason\": \"Company likely has fewer than 100 employees\", \"status\": \"SKIPPED_SMALL_COMPANY\"}. The form5500_name_test tool uses inclusive search, so searching for 'Behavior Frontiers' will return 'Behavior Frontiers LLC', 'Behavior Frontiers Inc', etc. Use this search strategy: 1) If the previous task found a legal entity name, test that name first 2) Test the original company name 3) If no exact match, start with SHORTENED search terms for wider results: Remove common suffixes (LLC, Inc, Corp, Company, Co, Ltd) first, then try core business name only (e.g. 'Behavior Frontiers' instead of 'Behavior Frontiers Therapy Services LLC') 4) Then try common variations: Add/remove different legal suffixes; Remove punctuation and special characters; Try with/without 'The', 'A', 'An' articles 5) Record all matches found and their quality. The inclusive search means you should start broad and get specific, not the reverse. If a good match is found, return: {\"company_name\": \"Original Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {...}, \"legal_entity_research\": {...}, \"form5500_match\": {\"legal_name\": \"Matched Legal Name\", \"ein\": \"12-3456789\", \"location\": \"City, State ZIP\", \"match_type\": \"exact/contains/partial\", \"record_count\": 5, \"variation_used\": \"variation tested\"}, \"status\": \"READY_FOR_EXTRACTION\"}. If no good match is found, return: {\"company_name\": \"Company Name\", \"firm_name\": \"PE Firm Name\", \"headquarters_location\": {...}, \"portfolio_verification\": {...}, \"employee_count_assessment\": {...}, \"legal_entity_research\": {...}, \"form5500_attempts\": {\"variations_tested\": [\"Name\", \"Name LLC\", \"Name Inc\"], \"best_partial_matches\": [{\"legal_name\": \"Similar Name LLC\", \"match_type\": \"partial\", \"location\": \"Different City, ST\"}]}, \"status\": \"NEEDS_ADVANCED_RESOLUTION\"}. Use form5500_name_test multiple times as needed. Test systematic variations starting broad then getting specific. A 'good match' means exact or very close match with reasonable confidence. Document all variations attempted. Include only the formatted JSON in your response, exclude any other text or comments."
      }
    ]
  }
}