{
  "workflow": {
    "name": "Portfolio Company Verification and Form 5500 Matching",
    "description": "Multi-step verification of portfolio companies with Form 5500 matching",
    "tasks": [
      {
        "id": 1,
        "name": "ResearchCompanyLocations",
        "outputKey": "companies_with_locations",
        "inputKeys": ["input"],
        "instructions": "Find headquarters location for the portfolio company. Use perplexity_search to find city, state, and full address. Return JSON: {company_name, firm_name, headquarters_location: {city, state, full_address, research_confidence}}. If there are two possibilities and it's unclear which is true, use both. Include no comments in your response."
      },
      {
        "id": 2,
        "name": "VerifyPortfolioStatus", 
        "outputKey": "verified_portfolio_companies",
        "inputKeys": ["companies_with_locations"],
        "instructions": "Verify if company is active portfolio of PE firm using perplexity_search. If you find acquisition by 'unnamed' or 'undisclosed' PE firm, assume this refers to the firm in question. Only mark inactive if sold to a specifically named different firm. Return JSON: {company_name, firm_name, headquarters_location, portfolio_verification: {is_active_portfolio: bool, verification_confidence, investment_details, status_notes}} OR {company_name, firm_name, reason, headquarters_location, is_active_portfolio: false} if not active. Include no comments in your response."
      },
      {
        "id": 3,
        "name": "CheckEmployeeCount",
        "outputKey": "employee_count_check",
        "inputKeys": ["verified_portfolio_companies"],
        "instructions": "Research 2024 employee count using perplexity_search. Only proceed if 'is_active_portfolio: true'. Return JSON: {company_name, firm_name, headquarters_location, portfolio_verification, employee_count_assessment: {likely_under_100_employees: bool, confidence, evidence, year: '2024'}, status: 'LIKELY_NO_FORM_5500' or 'PROCEED_TO_FORM_5500'}. If not active portfolio, return 'status: LIKELY_NO_FORM_5500'. Include no comments in your response."
      },
      {
        "id": 4,
        "name": "FindLegalEntityName",
        "outputKey": "legal_entity_research",
        "inputKeys": ["employee_count_check"],
        "instructions": "Find legal entity name using perplexity_search query: 'What legal entity is DBA [company name], a portfolio company of [pe firm name]?' Only proceed if status: 'PROCEED_TO_FORM_5500'. Return JSON: {company_name, firm_name, headquarters_location, portfolio_verification, employee_count_assessment, legal_entity_research: {legal_entity_name, research_confidence, source_info}, status: 'LEGAL_ENTITY_FOUND' or 'LEGAL_ENTITY_UNCLEAR'}. Include no comments in your response."
      },
      {
        "id": 5,
        "name": "TestForm5500Matches",
        "outputKey": "form5500_test_results", 
        "inputKeys": ["legal_entity_research"],
        "instructions": "Test Form 5500 matches using form5500_name_test. Only proceed if status: 'LEGAL_ENTITY_FOUND' or 'LEGAL_ENTITY_UNCLEAR'. Search order: 1) Legal entity name from previous task 2) Original company name 3) Shortened versions (remove suffixes) 4) Common variations. Inclusive search returns broader results, so start broad. Return JSON: {company_name, firm_name, headquarters_location, portfolio_verification, employee_count_assessment, legal_entity_research, form5500_match: {legal_name, ein, location, match_type, record_count, variation_used}, status: 'READY_FOR_EXTRACTION' or 'NEEDS_ADVANCED_RESOLUTION'}. Include no comments in your response."
      }
    ]
  }
}